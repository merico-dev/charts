"use strict";

var _interopRequireDefault = require("@babel/runtime-corejs2/helpers/interopRequireDefault");

var _Object$defineProperty = require("@babel/runtime-corejs2/core-js/object/define-property");

_Object$defineProperty(exports, "__esModule", {
  value: true
});

exports.calcDownwardsSeriesData = exports.calcUpwardsSeriesData = exports.calcBurndown = exports.calcAcc = void 0;

var _from = _interopRequireDefault(require("@babel/runtime-corejs2/core-js/array/from"));

var _moment = _interopRequireDefault(require("moment"));

var _lodash = require("lodash");

var NOW = (0, _moment["default"])('2020-12-01');

var calcAcc = function calcAcc(key) {
  return function (data) {
    data.forEach(function (item, index) {
      if (index === 0) {
        return;
      }

      item[key] += data[index - 1][key];
    });
    return data;
  };
};

exports.calcAcc = calcAcc;

var calcBurndown = function calcBurndown(key) {
  return function (data) {
    var copy = (0, _lodash.cloneDeep)(data);

    for (var i = copy.length - 2; i >= 0; i--) {
      copy[i][key] += copy[i + 1][key];
    }

    copy.forEach(function (item) {
      item[key] += 500;
    });
    return copy;
  };
};

exports.calcBurndown = calcBurndown;

function calcSeriesBase(keys, dataCount, extendDays) {
  var now = NOW.clone();
  var randomBase = (0, _from["default"])(new Array(dataCount), function () {
    var ret = keys.reduce(function (acc, curr) {
      acc[curr] = Math.random();
      return acc;
    }, {});
    ret.date = now.add(1, 'days').toISOString();
    return ret;
  });
  var lastDate = (0, _moment["default"])((0, _lodash.last)(randomBase).date);
  var tailingDates = (0, _from["default"])(new Array(extendDays), function () {
    var ret = keys.reduce(function (acc, curr) {
      acc[curr] = null;
      return acc;
    }, {});
    ret.date = lastDate.add(1, 'days').toISOString();
    return ret;
  });
  return randomBase.concat(tailingDates);
}

function adjustValue(data, key, factor) {
  data.forEach(function (item) {
    item[key] = (0, _lodash.round)(item[key] * factor);
  });
}
/**
 * Like:
 * [
 *  {
 *    line-1: number,
 *    line-2: number,
 *    issue-range: number,
 *    date: ISOString,
 *  }
 * ]
 */


var calcUpwardsSeriesData = function calcUpwardsSeriesData(_ref) {
  var dataCount = _ref.dataCount,
      extendDays = _ref.extendDays,
      _ref$keys = _ref.keys,
      keys = _ref$keys === void 0 ? ['line-1', 'line-2'] : _ref$keys,
      _ref$factors = _ref.factors,
      factors = _ref$factors === void 0 ? [100, 100] : _ref$factors,
      _ref$accumulators = _ref.accumulators,
      accumulators = _ref$accumulators === void 0 ? [calcBurndown, calcBurndown] : _ref$accumulators;
  return function () {
    var base = calcSeriesBase(keys, dataCount, extendDays); // @ts-expect-error ts-migrate(7006) FIXME: Parameter 'key' implicitly has an 'any' type.

    keys.forEach(function (key, index) {
      adjustValue(base, key, factors[index]);
    }); // @ts-expect-error ts-migrate(7006) FIXME: Parameter 'acc' implicitly has an 'any' type.

    accumulators.forEach(function (acc, index) {
      if (!acc) {
        return;
      }

      var key = keys[index];
      base = acc(key)(base);
    }); // base[base.length - 1][keys[0]] = 0;
    // NOTE: add range data for area chart

    base.forEach(function (row) {
      var upper = row[keys[0]] * 1.15;
      var lower = row[keys[1]] * 0.85;
      row['issue-range'] = [upper, lower];
    });
    return base;
  };
};

exports.calcUpwardsSeriesData = calcUpwardsSeriesData;
var calcDownwardsSeriesData = calcUpwardsSeriesData;
exports.calcDownwardsSeriesData = calcDownwardsSeriesData;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL2NoYXJ0cy9jb21wb3NlZC1jaGFydHMvc2VyaWVzLWNvbXBvc2VkLWNoYXJ0L3N0b3JpZXMvbGluZXMtYW5kLWFyZWFzL2hlbHBlcnMudHMiXSwibmFtZXMiOlsiTk9XIiwiY2FsY0FjYyIsImtleSIsImRhdGEiLCJmb3JFYWNoIiwiaXRlbSIsImluZGV4IiwiY2FsY0J1cm5kb3duIiwiY29weSIsImkiLCJsZW5ndGgiLCJjYWxjU2VyaWVzQmFzZSIsImtleXMiLCJkYXRhQ291bnQiLCJleHRlbmREYXlzIiwibm93IiwiY2xvbmUiLCJyYW5kb21CYXNlIiwiQXJyYXkiLCJyZXQiLCJyZWR1Y2UiLCJhY2MiLCJjdXJyIiwiTWF0aCIsInJhbmRvbSIsImRhdGUiLCJhZGQiLCJ0b0lTT1N0cmluZyIsImxhc3REYXRlIiwidGFpbGluZ0RhdGVzIiwiY29uY2F0IiwiYWRqdXN0VmFsdWUiLCJmYWN0b3IiLCJjYWxjVXB3YXJkc1Nlcmllc0RhdGEiLCJmYWN0b3JzIiwiYWNjdW11bGF0b3JzIiwiYmFzZSIsInJvdyIsInVwcGVyIiwibG93ZXIiLCJjYWxjRG93bndhcmRzU2VyaWVzRGF0YSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFFQSxJQUFNQSxHQUFHLEdBQUcsd0JBQU8sWUFBUCxDQUFaOztBQUVPLElBQU1DLE9BQU8sR0FBRyxTQUFWQSxPQUFVLENBQUNDLEdBQUQ7QUFBQSxTQUFjLFVBQUNDLElBQUQsRUFBZTtBQUNsREEsSUFBQUEsSUFBSSxDQUFDQyxPQUFMLENBQWEsVUFBQ0MsSUFBRCxFQUFZQyxLQUFaLEVBQTJCO0FBQ3RDLFVBQUlBLEtBQUssS0FBSyxDQUFkLEVBQWlCO0FBQ2Y7QUFDRDs7QUFDREQsTUFBQUEsSUFBSSxDQUFDSCxHQUFELENBQUosSUFBYUMsSUFBSSxDQUFDRyxLQUFLLEdBQUcsQ0FBVCxDQUFKLENBQWdCSixHQUFoQixDQUFiO0FB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QUFDQyxLQUFELEVBQVFDLEtBQVIsQ0FBckI7QUFDRCxLQUpEO0FBS0EsV0FBT0gsSUFBUDtBQUNELEdBN0JvQztBQUFBLENBQTlCOzs7QUErQkEsSUFBTUksdUJBQXVCLEdBQUdQLHFCQUFoQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBtb21lbnQgZnJvbSAnbW9tZW50JztcbmltcG9ydCB7IGNsb25lRGVlcCwgbGFzdCwgcm91bmQgfSBmcm9tICdsb2Rhc2gnO1xuXG5jb25zdCBOT1cgPSBtb21lbnQoJzIwMjAtMTItMDEnKTtcblxuZXhwb3J0IGNvbnN0IGNhbGNBY2MgPSAoa2V5OiBhbnkpID0+IChkYXRhOiBhbnkpID0+IHtcbiAgZGF0YS5mb3JFYWNoKChpdGVtOiBhbnksIGluZGV4OiBhbnkpID0+IHtcbiAgICBpZiAoaW5kZXggPT09IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaXRlbVtrZXldICs9IGRhdGFbaW5kZXggLSAxXVtrZXldO1xuICB9KTtcbiAgcmV0dXJuIGRhdGE7XG59O1xuXG5leHBvcnQgY29uc3QgY2FsY0J1cm5kb3duID0gKGtleTogYW55KSA9PiAoZGF0YTogYW55KSA9PiB7XG4gIGNvbnN0IGNvcHkgPSBjbG9uZURlZXAoZGF0YSk7XG4gIGZvciAobGV0IGkgPSBjb3B5Lmxlbmd0aCAtIDI7IGkgPj0gMDsgaS0tKSB7XG4gICAgY29weVtpXVtrZXldICs9IGNvcHlbaSArIDFdW2tleV07XG4gIH1cbiAgY29weS5mb3JFYWNoKChpdGVtOiBhbnkpID0+IHtcbiAgICBpdGVtW2tleV0gKz0gNTAwO1xuICB9KTtcbiAgcmV0dXJuIGNvcHk7XG59O1xuXG5mdW5jdGlvbiBjYWxjU2VyaWVzQmFzZShrZXlzOiBhbnksIGRhdGFDb3VudDogYW55LCBleHRlbmREYXlzOiBhbnkpIHtcbiAgY29uc3Qgbm93ID0gTk9XLmNsb25lKCk7XG4gIGNvbnN0IHJhbmRvbUJhc2UgPSBBcnJheS5mcm9tKG5ldyBBcnJheShkYXRhQ291bnQpLCAoKSA9PiB7XG4gICAgY29uc3QgcmV0ID0ga2V5cy5yZWR1Y2UoKGFjYzogYW55LCBjdXJyOiBhbnkpID0+IHtcbiAgICAgIGFjY1tjdXJyXSA9IE1hdGgucmFuZG9tKCk7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9KTtcbiAgICByZXQuZGF0ZSA9IG5vdy5hZGQoMSwgJ2RheXMnKS50b0lTT1N0cmluZygpO1xuICAgIHJldHVybiByZXQ7XG4gIH0pO1xuXG4gIGNvbnN0IGxhc3REYXRlID0gbW9tZW50KGxhc3QocmFuZG9tQmFzZSkuZGF0ZSk7XG4gIGNvbnN0IHRhaWxpbmdEYXRlcyA9IEFycmF5LmZyb20obmV3IEFycmF5KGV4dGVuZERheXMpLCAoKSA9PiB7XG4gICAgY29uc3QgcmV0ID0ga2V5cy5yZWR1Y2UoKGFjYzogYW55LCBjdXJyOiBhbnkpID0+IHtcbiAgICAgIGFjY1tjdXJyXSA9IG51bGw7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9KTtcbiAgICByZXQuZGF0ZSA9IGxhc3REYXRlLmFkZCgxLCAnZGF5cycpLnRvSVNPU3RyaW5nKCk7XG4gICAgcmV0dXJuIHJldDtcbiAgfSk7XG4gIHJldHVybiByYW5kb21CYXNlLmNvbmNhdCh0YWlsaW5nRGF0ZXMpO1xufVxuXG5mdW5jdGlvbiBhZGp1c3RWYWx1ZShkYXRhOiBhbnksIGtleTogYW55LCBmYWN0b3I6IGFueSkge1xuICBkYXRhLmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xuICAgIGl0ZW1ba2V5XSA9IHJvdW5kKGl0ZW1ba2V5XSAqIGZhY3Rvcik7XG4gIH0pO1xufVxuXG4vKipcbiAqIExpa2U6XG4gKiBbXG4gKiAge1xuICogICAgbGluZS0xOiBudW1iZXIsXG4gKiAgICBsaW5lLTI6IG51bWJlcixcbiAqICAgIGlzc3VlLXJhbmdlOiBudW1iZXIsXG4gKiAgICBkYXRlOiBJU09TdHJpbmcsXG4gKiAgfVxuICogXVxuICovXG5leHBvcnQgY29uc3QgY2FsY1Vwd2FyZHNTZXJpZXNEYXRhID0gKHtcbiAgZGF0YUNvdW50LFxuICBleHRlbmREYXlzLFxuICBrZXlzID0gWydsaW5lLTEnLCAnbGluZS0yJ10sXG4gIGZhY3RvcnMgPSBbMTAwLCAxMDBdLFxuICBhY2N1bXVsYXRvcnMgPSBbY2FsY0J1cm5kb3duLCBjYWxjQnVybmRvd25dLFxufTogYW55KSA9PiAoKSA9PiB7XG4gIGxldCBiYXNlID0gY2FsY1Nlcmllc0Jhc2Uoa2V5cywgZGF0YUNvdW50LCBleHRlbmREYXlzKTtcbiAgLy8gQHRzLWV4cGVjdC1lcnJvciB0cy1taWdyYXRlKDcwMDYpIEZJWE1FOiBQYXJhbWV0ZXIgJ2tleScgaW1wbGljaXRseSBoYXMgYW4gJ2FueScgdHlwZS5cbiAga2V5cy5mb3JFYWNoKChrZXksIGluZGV4KSA9PiB7XG4gICAgYWRqdXN0VmFsdWUoYmFzZSwga2V5LCBmYWN0b3JzW2luZGV4XSk7XG4gIH0pO1xuICAvLyBAdHMtZXhwZWN0LWVycm9yIHRzLW1pZ3JhdGUoNzAwNikgRklYTUU6IFBhcmFtZXRlciAnYWNjJyBpbXBsaWNpdGx5IGhhcyBhbiAnYW55JyB0eXBlLlxuICBhY2N1bXVsYXRvcnMuZm9yRWFjaCgoYWNjLCBpbmRleCkgPT4ge1xuICAgIGlmICghYWNjKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGtleSA9IGtleXNbaW5kZXhdO1xuICAgIGJhc2UgPSBhY2Moa2V5KShiYXNlKTtcbiAgfSk7XG4gIC8vIGJhc2VbYmFzZS5sZW5ndGggLSAxXVtrZXlzWzBdXSA9IDA7XG5cbiAgLy8gTk9URTogYWRkIHJhbmdlIGRhdGEgZm9yIGFyZWEgY2hhcnRcbiAgYmFzZS5mb3JFYWNoKChyb3cpID0+IHtcbiAgICBjb25zdCB1cHBlciA9IHJvd1trZXlzWzBdXSAqIDEuMTU7XG4gICAgY29uc3QgbG93ZXIgPSByb3dba2V5c1sxXV0gKiAwLjg1O1xuICAgIHJvd1snaXNzdWUtcmFuZ2UnXSA9IFt1cHBlciwgbG93ZXJdO1xuICB9KTtcbiAgcmV0dXJuIGJhc2U7XG59O1xuXG5leHBvcnQgY29uc3QgY2FsY0Rvd253YXJkc1Nlcmllc0RhdGEgPSBjYWxjVXB3YXJkc1Nlcmllc0RhdGE7XG4iXX0=